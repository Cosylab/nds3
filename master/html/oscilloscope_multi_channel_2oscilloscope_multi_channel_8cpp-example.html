<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>NDS3: oscilloscopeMultiChannel/oscilloscopeMultiChannel.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NDS3
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">API reference manual</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('oscilloscope_multi_channel_2oscilloscope_multi_channel_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">oscilloscopeMultiChannel/oscilloscopeMultiChannel.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example shows a fictional multi-channel oscilloscope. When the acquisition is triggered on a channel then the channel pushes a sinusoidal wave to the control system.</p>
<p>The example shows how to create the channels programmatically (useful when you have a large number of channel that offer the same functionality).</p>
<p>The Makefile for the sample is the following: </p>
<div class="fragment"><div class="line">CXX = g++</div>
<div class="line"> </div>
<div class="line">CXXFLAGS = -std=c++0x -Wall -Wextra -pedantic -fPIC -pthread -DNDS3_DLL</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Flags passed to gcc during linking</span></div>
<div class="line"><span class="preprocessor"></span>LINK = -shared -fPIC -Wl,-as-needed</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Name of the nds library</span></div>
<div class="line"><span class="preprocessor"></span>TARGET = liboscilloscopemultichannel.so</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Additional linker libraries</span></div>
<div class="line"><span class="preprocessor"></span>LIBS = -lnds3</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Source code files used in this project</span></div>
<div class="line"><span class="preprocessor"></span>SRCS = oscilloscopeMultiChannel.cpp</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">OBJS = $(SRCS:.cpp=.o)</div>
<div class="line"># Rules <span class="keywordflow">for</span> building</div>
<div class="line">$(TARGET): $(OBJS)</div>
<div class="line">    $(CXX) $(LINK) -o $@ $^ $(LIBS)</div>
<div class="line"> </div>
<div class="line">.PHONY: clean</div>
<div class="line">clean:</div>
<div class="line">    $(RM) $(TARGET) $(OBJS)</div>
</div><!-- fragment --><p>The macro NDS_DEFINE_DRIVER tells that the Oscilloscope class is the one that must be allocated and initialized when the control system wants to use our "Oscilloscope" device.</p>
<p>The constructor of our oscilloscope creates a root node for the device and names it using the parameter <b>device</b> passed by the control system. It is not mandatory to call the root node using the <b>device</b> parameter.</p>
<p>The root node is declared as a Port: this means that it holds an interface with the control system.<br/>
We could have declared the root node as a simple Node and each channel as a Port: in this case each channel would keep an interface with the control system and all its callback would be executed on separate threads (one per channel).</p>
<p>The Channel class is just a helper that add the acquisition nodes to the root one and keep few references to the channel's PVs and to the channel's acquisition node. For fewer number of channels we could have implemented this functionality directly in the Oscillocope class.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nds_8h.html">nds3/nds.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Channel; <span class="comment">// Forward declaration</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Oscilloscope</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Oscilloscope(<a name="_a0"></a><a class="code" href="classnds_1_1_factory.html">nds::Factory</a>&amp; factory, <span class="keyword">const</span> std::string&amp; device, <span class="keyword">const</span> <a class="code" href="namespacends.html#a1623ccf32bf1883cc75d22e2471c535b">nds::namedParameters_t</a>&amp; parameters);</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::vector&lt;std::shared_ptr&lt;Channel&gt; &gt; m_channels;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Channel</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Channel(<span class="keyword">const</span> std::string&amp; name, <a name="_a1"></a><a class="code" href="classnds_1_1_node.html">nds::Node</a>&amp; parentNode);</div>
<div class="line"></div>
<div class="line">    <a name="_a2"></a><a class="code" href="classnds_1_1_data_acquisition.html">nds::DataAcquisition&lt;std::vector&lt;std::int32_t&gt;</a> &gt; m_acquisition;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * @brief A variable PV that stores the amplitude of the wave.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <a name="_a3"></a><a class="code" href="classnds_1_1_p_v_variable_out.html">nds::PVVariableOut&lt;std::int32_t&gt;</a> m_amplitude;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> switchOn();  </div>
<div class="line">    <span class="keywordtype">void</span> switchOff(); </div>
<div class="line">    <span class="keywordtype">void</span> start();     </div>
<div class="line">    <span class="keywordtype">void</span> stop();      </div>
<div class="line">    <span class="keywordtype">void</span> recover();   </div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> allowChange(<span class="keyword">const</span> <a class="code" href="namespacends.html#a5ad0010c1a8c5890f6fb996f72a34c81">nds::state_t</a>, <span class="keyword">const</span> <a class="code" href="namespacends.html#a5ad0010c1a8c5890f6fb996f72a34c81">nds::state_t</a>, <span class="keyword">const</span> <a class="code" href="namespacends.html#a5ad0010c1a8c5890f6fb996f72a34c81">nds::state_t</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> acquisitionLoop();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">volatile</span> <span class="keywordtype">bool</span> m_bStopAcquisition;</div>
<div class="line"></div>
<div class="line">    <a name="_a4"></a><a class="code" href="classnds_1_1_thread.html">nds::Thread</a> m_acquisitionThread;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// THE IMPLEMENTATION FOR THE OSCILLOSCOPE CLASS FOLLOWS: IN A REALD LIFE</span></div>
<div class="line"><span class="comment">// SITUATION THIS WOULD BE IN A DIFFERENT FILE</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Constructor for our Oscilloscope device.</span></div>
<div class="line"><span class="comment">// It declares all the nodes and PVs in the device, then register the root node</span></div>
<div class="line"><span class="comment">//  (which in turn register all its children).</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span>Oscilloscope::Oscilloscope(<a class="code" href="classnds_1_1_factory.html">nds::Factory</a> &amp;factory, <span class="keyword">const</span> std::string &amp;deviceName, <span class="keyword">const</span> <a class="code" href="namespacends.html#a1623ccf32bf1883cc75d22e2471c535b">nds::namedParameters_t</a> &amp; <span class="comment">/* parameters */</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Here we declare the root node.</span></div>
<div class="line">    <span class="comment">// It is a good practice to name it with the device name.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Also, for simplicity we declare it as a &quot;Port&quot;: this means that</span></div>
<div class="line">    <span class="comment">//  the root node will be responsible for the communication with</span></div>
<div class="line">    <span class="comment">//  the underlying control system.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// It is possible to have the root node as a simple Node and promote one or</span></div>
<div class="line">    <span class="comment">//  more of its children to &quot;Port&quot;: each port will interface with a different</span></div>
<div class="line">    <span class="comment">//  control system thread.</span></div>
<div class="line"><span class="comment"></span>    <a name="_a5"></a><a class="code" href="classnds_1_1_port.html">nds::Port</a> rootNode(deviceName);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Let&#39;s add 32 acquisition channels to the root node</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> numChannel(0); numChannel != 16; ++numChannel)</div>
<div class="line">    {</div>
<div class="line">        std::ostringstream channelName;</div>
<div class="line">        channelName &lt;&lt; <span class="stringliteral">&quot;Ch&quot;</span> &lt;&lt; numChannel;</div>
<div class="line">        m_channels.push_back(std::make_shared&lt;Channel&gt;(channelName.str(), rootNode));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// We have declared all the nodes and PVs in our device: now we register them</span></div>
<div class="line">    <span class="comment">//  with the control system that called this constructor.</span></div>
<div class="line"><span class="comment"></span>    rootNode.initialize(<span class="keyword">this</span>, factory);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Constructor for an acquisition channel</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span>Channel::Channel(<span class="keyword">const</span> std::string &amp;name, <a class="code" href="classnds_1_1_node.html">nds::Node</a> &amp;parentNode)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnds_1_1_node.html">nds::Node</a> channel = parentNode.<a name="a6"></a><a class="code" href="classnds_1_1_node.html#a6081d6501b51914293d4f22b5db74697">addChild</a>(<a class="code" href="classnds_1_1_node.html">nds::Node</a>(name));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// We create an acquisition node with the requested name...</span></div>
<div class="line"><span class="comment"></span>    m_acquisition = <a class="code" href="classnds_1_1_data_acquisition.html">nds::DataAcquisition&lt;std::vector&lt;std::int32_t&gt;</a> &gt;(<span class="stringliteral">&quot;Acquisition&quot;</span>,</div>
<div class="line">                                                                     100,</div>
<div class="line">                                                                     std::bind(&amp;Channel::switchOn, <span class="keyword">this</span>),</div>
<div class="line">                                                                     std::bind(&amp;Channel::switchOff, <span class="keyword">this</span>),</div>
<div class="line">                                                                     std::bind(&amp;Channel::start, <span class="keyword">this</span>),</div>
<div class="line">                                                                     std::bind(&amp;Channel::stop, <span class="keyword">this</span>),</div>
<div class="line">                                                                     std::bind(&amp;Channel::recover, <span class="keyword">this</span>),</div>
<div class="line">                                                                     std::bind(&amp;Channel::allowChange, <span class="keyword">this</span>,</div>
<div class="line">                                                                               std::placeholders::_1,</div>
<div class="line">                                                                               std::placeholders::_2,</div>
<div class="line">                                                                               std::placeholders::_3));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ...and we add it to the root</span></div>
<div class="line"><span class="comment"></span>    channel.<a class="code" href="classnds_1_1_node.html#a6081d6501b51914293d4f22b5db74697">addChild</a>(m_acquisition);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// We also add to the acquisition node a PV that specifies the amplitude of the</span></div>
<div class="line">    <span class="comment">//  generated wave</span></div>
<div class="line"><span class="comment"></span>    m_amplitude = <a class="code" href="classnds_1_1_p_v_variable_out.html">nds::PVVariableOut&lt;std::int32_t&gt;</a>(<span class="stringliteral">&quot;Amplitude&quot;</span>);</div>
<div class="line">    channel.<a class="code" href="classnds_1_1_node.html#a6081d6501b51914293d4f22b5db74697">addChild</a>(m_amplitude);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Called when the acquisition node has to be switched on.</span></div>
<div class="line"><span class="comment">// Here we do nothing (in our case no special operations are needed to switch</span></div>
<div class="line"><span class="comment">//  on the node).</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> Channel::switchOn()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Called when the acquisition node has to be switched off.</span></div>
<div class="line"><span class="comment">// Here we do nothing (in our case no special operations are needed to switch</span></div>
<div class="line"><span class="comment">//  off the node).</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> Channel::switchOff()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Called when the acquisition node has to start acquiring.</span></div>
<div class="line"><span class="comment">// We start the data acquisition thread for the sinusoidal wave</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> Channel::start()</div>
<div class="line">{</div>
<div class="line">    m_bStopAcquisition = <span class="keyword">false</span>; <span class="comment">//&lt; We will set to true to stop the acquisition thread</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Start the acquisition thread.</span></div>
<div class="line">    <span class="comment">// We don&#39;t need to check if the thread was already started because the state</span></div>
<div class="line">    <span class="comment">//  machine guarantees that the start handler is called only while the state</span></div>
<div class="line">    <span class="comment">//  is ON.</span></div>
<div class="line"><span class="comment"></span>    m_acquisitionThread = m_acquisition.runInThread(<span class="stringliteral">&quot;Acquisition&quot;</span>, std::bind(&amp;Channel::acquisitionLoop, <span class="keyword">this</span>));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Stop the acquisition thread</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> Channel::stop()</div>
<div class="line">{</div>
<div class="line">    m_bStopAcquisition = <span class="keyword">true</span>;</div>
<div class="line">    m_acquisitionThread.join();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// A failure during a state transition will cause the state machine to switch</span></div>
<div class="line"><span class="comment">//  to the failure state. For now we don&#39;t plan for this and every time the</span></div>
<div class="line"><span class="comment">//  state machine wants to recover we throw StateMachineRollBack to force</span></div>
<div class="line"><span class="comment">//  the state machine to stay on the failure state.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> Channel::recover()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">throw</span> <a name="_a7"></a><a class="code" href="classnds_1_1_state_machine_roll_back.html">nds::StateMachineRollBack</a>(<span class="stringliteral">&quot;Cannot recover&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// We always allow the state machine to switch state.</span></div>
<div class="line"><span class="comment">// Before calling this function the state machine has already verified that the</span></div>
<div class="line"><span class="comment">//  requested state transition is legal.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">bool</span> Channel::allowChange(<span class="keyword">const</span> <a class="code" href="namespacends.html#a5ad0010c1a8c5890f6fb996f72a34c81">nds::state_t</a>, <span class="keyword">const</span> <a class="code" href="namespacends.html#a5ad0010c1a8c5890f6fb996f72a34c81">nds::state_t</a>, <span class="keyword">const</span> <a class="code" href="namespacends.html#a5ad0010c1a8c5890f6fb996f72a34c81">nds::state_t</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Acquisition function. It is launched in a separate thread by start().</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> Channel::acquisitionLoop()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Let&#39;s allocate a vector that will contain the data that we will push to the</span></div>
<div class="line">    <span class="comment">//  control system</span></div>
<div class="line"><span class="comment"></span>    std::vector&lt;std::int32_t&gt; outputData(m_acquisition.getMaxElements());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// A counter for the angle in the sin() operation</span></div>
<div class="line"><span class="comment"></span>    std::int64_t angle(0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Run until the state machine stops us</span></div>
<div class="line"><span class="comment"></span>    <span class="keywordflow">while</span>(!m_bStopAcquisition)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Fill the vector with a sin wave</span></div>
<div class="line"><span class="comment"></span>        <span class="keywordtype">size_t</span> maxAmplitude = m_amplitude.getValue(); <span class="comment">// PVVariables are thread safe</span></div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> scanVector(0); scanVector != outputData.size(); ++scanVector)</div>
<div class="line">        {</div>
<div class="line">            outputData[scanVector] = (double)maxAmplitude * sin((<span class="keywordtype">double</span>)(angle++) / 10.0f);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Push the vector to the control system</span></div>
<div class="line"><span class="comment"></span>        m_acquisition.push(m_acquisition.getTimestamp(), outputData);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Rest for a while</span></div>
<div class="line"><span class="comment"></span>        ::usleep(100000);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// The following MACRO defines the function to be exported in order</span></div>
<div class="line"><span class="comment">//  to allow the dynamic loading of the shared module</span></div>
<div class="line"><span class="comment"></span><a name="a8"></a><a class="code" href="definitions_8h.html#abae220b9d7ab927324ef6caa20107576">NDS_DEFINE_DRIVER</a>(OscilloscopeMultiChannel, Oscilloscope)</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 17 2018 23:30:10 for NDS3 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
